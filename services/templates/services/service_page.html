{% extends "base.html" %}

{% load static %}

{% block extra_title %} | {{ service.name }}{% endblock %}

{% block content %}

<div class="container-fluid">

    <div class="row my-3">
        <div class="col-10 offset-1 col-lg-8 offset-lg-2 col-xl-6 offset-xl-3 mt-2">
            <h1 class="mate">{{ service.name }}</h1>
            <p class="small sage-green mb-0"><a href="{% url 'services' %}"
                    class="plain-anchor sage-green service-link">Services</a> > <a
                    href="{% url 'services' %}?category={{ service.category }}"
                    class="plain-anchor sage-green service-link">{{ service.category.friendly_name }}</a> >
                <span class="fw-bold">{{ service.name }}</span></p>
        </div>
    </div>

    <div class="row pb-3">
        <div class="col-10 offset-1 col-sm-4 col-md-5 offset-md-1 col-lg-4 offset-lg-2 col-xl-2 offset-xl-3">
            <img src="{{ MEDIA_URL }}{{ service.image }}" class="card-img-top img-shadow mb-2" alt="Image of a {{ service.name }} service">
        </div>
        <div class="col-10 offset-1 col-sm-6 offset-sm-0 col-md-5 col-lg-4">
            <div class="service-details-container">
                <!-- <h5 class="mate">{{ service.name }}</h5> -->
                <p class="mb-0">{{ service.description | safe }}</p>
                <div class="d-flex align-items-center mb-3">
                    <div class="star-ratings mb-1">
                        <div class="fill-ratings" style="width: 0%;">
                            <span>★★★★★</span>
                        </div>
                        <div class="empty-ratings">
                            <span>★★★★★</span>
                        </div>
                        <div id="rating" hidden>{{ service.average_rating }}</div>
                    </div>
                    <div>
                        <div class="ms-2 text-muted">
                            {% if service.average_rating %}
                            ({{ service.average_rating }}) <a href="{% url 'service_reviews' service.id %}" class="hunter-green ms-1">{{ service.review_count }} Review{% if service.review_count > 1 %}s{% endif %}</a>
                            {% else %}
                            (No Reviews)
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!-- Form for selecting the service option -->
                <form class="form my-3" method="POST" action="{% url 'add_to_cart' service.id %}">
                    {% csrf_token %}
                    <div class="form-row">

                        <!-- Input Type 1 - Weed Surface -->
                        {% if service.has_surface %}
                        <div id="weed-input" class="py-1">
                            <label for="weedOption"><b>Surface Type:</b></label>
                            <div class="form-group w-75">
                                <select id="weedOption" name="surface" class="form-select">
                                    <option selected value="Driveway/Patio">Driveway/Patio</option>
                                    <option value="Bed/Planter">Bed/Planter</option>
                                </select>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Input Type 2 - Felling or Pruning -->
                        {% if service.has_fellprune %}
                        <div id="tree-input" class="py-1">
                            <label for="treeOption"><b>Select Option:</b></label>
                            <div class="form-group w-75">
                                <select id="treeOption" name="tree" class="form-select">
                                    <option selected value="felling">Felling</option>
                                    <option value="pruning">Pruning</option>
                                    <option value="coppicing">Coppicing</option>
                                    <option value="pollarding">Pollarding</option>
                                </select>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Input Type 3 - Size -->
                        {% if service.has_sizes %}
                        <div id="size-input" class="py-1">
                            <label for="sizeOption"><b>Size of <span
                                        class="service-name">{{ service.name }}</span></b></label>
                            <div class="form-group w-75">
                                <select id="grassOption" name="size" class="form-select">
                                    <option selected value="small">Small</option>
                                    <option value="medium">Medium</option>
                                    <option value="large">Large</option>
                                </select>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Input Type 4 - Number -->
                        <div id="number-input" class="py-1">
                            <label for="numberOption"><b>Number of <span
                                        class="service-name">{{ service.name }}</span>s</b></label>
                            <div class="form-group w-75">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <button class="decrement-number btn hunter-green-bg isabelline" 
                                            data-item_id="{{ service.id }}" id="decrement-number_{{ service.id }}">
                                            <span class="icon">
                                                <i class="fas fa-minus"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <input type="number" class="form-control number_input" name="number" value="1"
                                        min="1" max="99" data-item_id="{{ service.id }}"
                                        id="id_number_{{ service.id }}">
                                    <div class="input-group-append">
                                        <button class="increment-number btn hunter-green-bg isabelline" 
                                            data-item_id="{{ service.id }}" id="increment-number_{{ service.id }}">
                                            <span class="icon">
                                                <i class="fas fa-plus"></i>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Input Type 5 - Acres -->
                        {% if service.has_acres %}
                        <div id="acre-input" class="py-1">
                            <label for="acreOption"><b>Select Option:</b></label>
                            <div class="form-group w-75">
                                <select id="acreOption" name="size" class="form-select">
                                    <option selected value="1 acre or less">1 acre or less</option>
                                    <option value="1-2 acres">1-2 acres</option>
                                    <option value="2+ acres">2+ acres</option>
                                </select>
                            </div>
                        </div>
                        {% endif %}

                        <div>
                            <p class="my-2"><b>Price:</b> €{{service.unit_price}} each</p>
                        </div>

                        <div class="my-3">
                            <a href="{% url 'services' %}"
                                class="btn rounded-1 hunter-green hunter-green-border isabelline-bg">
                                <i class="fas fa-caret-left"></i>
                                Services
                            </a>
                            <input type="submit" class="btn rounded-1 text-white hunter-green-bg text-uppercase"
                                value="Add to Cart" />
                        </div>
                    </div>
                    <input type="hidden" name="redirect_url" value="{{ request.path }}">
                </form>

            </div>
        </div>

    </div>
    <div class="d-none" id="service-name">{{ service.name }}</div>
</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script src="{% static 'js/service_form.js' %}"></script>
<script src="{% static 'js/number_inputs.js' %}"></script>
<script src="{% static 'js/star_ratings.js' %}"></script>
{% endblock %}